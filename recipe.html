<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Mama‚Äôs Secret Recipe Book ‚Äî Extended</title>
  <meta name="description" content="A vintage-styled recipe book app with speech-to-text, images, video, ratings, suggestions and export/import." />
  <style>
    /* ---------- THEME COLORS & TYPOGRAPHY ---------- */
    :root{
      --ocean:#0b6b88; /* ocean blue */
      --paper:#fffef6; /* antique white */
      --accent:#f7d84b; /* lemon yellow */
      --leaf:#2f9a4a; /* green leaf */
      --muted:#6a6a6a;
      --card:#ffffff;
      --shadow: rgba(11,107,136,0.12);
    }

    html,body{height:100%;margin:0;padding:0;background:linear-gradient(180deg,var(--paper) 0%, #e8f9ff 100%);font-family: 'Georgia', 'Palatino', serif;color:#222}

    /* ---------- LAYOUT ---------- */
    .center-heart{position:fixed;left:50%;top:48%;transform:translate(-50%,-50%);z-index:9999}
    .heart-btn{width:140px;height:140px;border-radius:70px;display:flex;align-items:center;justify-content:center;font-size:54px;background:linear-gradient(180deg,#fff6f6,#ffdbe0);box-shadow:0 12px 30px var(--shadow);cursor:pointer;user-select:none}
    .heart-btn.beat{animation:beat 1.2s infinite}
    @keyframes beat{14%{transform:translate(-50%,-50%) scale(1.12)}28%{transform:translate(-50%,-50%) scale(0.98)}}

    .app{display:none;position:fixed;inset:4vh 4vw;background:linear-gradient(180deg,rgba(11,107,136,0.04),rgba(255,255,255,0.98));backdrop-filter:blur(6px);border-radius:14px;box-shadow:0 20px 40px rgba(0,0,0,0.18);overflow:auto;padding:18px}

    .app-header{display:flex;align-items:center;gap:16px}
    .brand{font-size:22px;color:var(--ocean);font-weight:700}
    .emojis{font-size:20px}
    .close-btn{margin-left:auto;background:transparent;border:1px solid var(--ocean);color:var(--ocean);padding:8px 12px;border-radius:8px;cursor:pointer}

    .grid{display:grid;grid-template-columns:360px 1fr;gap:18px;margin-top:12px}
    .side{background:var(--card);padding:14px;border-radius:10px;box-shadow:inset 0 1px 0 rgba(255,255,255,0.6)}
    .main{background:var(--card);padding:16px;border-radius:10px}

    /* inputs */
    input[type=text], textarea, select{width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;font-family:inherit;font-size:14px}
    textarea{min-height:96px}
    .btn{display:inline-block;padding:8px 12px;border-radius:10px;border:none;cursor:pointer;background:var(--ocean);color:white;font-weight:700}
    .btn.alt{background:transparent;border:1px solid var(--ocean);color:var(--ocean)}
    .muted{color:var(--muted)}

    /* recipe card */
    .recipe-list{display:flex;flex-direction:column;gap:12px}
    .rcard{display:flex;gap:12px;padding:10px;border-radius:10px;border:1px dashed #eee;align-items:flex-start}
    .thumb{width:84px;height:84px;border-radius:8px;background:#fbfbfb;display:flex;align-items:center;justify-content:center}
    .meta{flex:1}

    /* selected view */
    .selected{padding:12px;border-radius:8px;background:linear-gradient(180deg,#fff,#fbfdff)}

    /* rating stars */
    .stars span{font-size:18px;cursor:pointer}

    /* confetti / celebrate */
    .celebrate{position:fixed;left:50%;top:10%;transform:translateX(-50%);padding:16px;background:rgba(255,255,255,0.98);border-radius:8px;box-shadow:0 10px 30px rgba(0,0,0,0.12);display:none;z-index:10000}

    footer{padding:18px;text-align:center;color:var(--muted);font-size:14px}

    /* responsive */
    @media(max-width:900px){.grid{grid-template-columns:1fr}.heart-btn{width:110px;height:110px;font-size:40px}}

    /* vintage touches */
    .vintage-border{border-top:6px solid rgba(11,107,136,0.06);padding-top:8px}

    /* small helper styles */
    .row{display:flex;gap:8px;align-items:center}
    .small{font-size:13px}
    .tag{display:inline-block;padding:4px 8px;border-radius:12px;background:#fff;color:var(--ocean);border:1px solid rgba(11,107,136,0.06);font-size:12px}

  </style>
</head>
<body>

  <!-- CENTER HEART (opens the app) -->
  <div class="center-heart">
    <div id="openHeart" class="heart-btn beat" title="Open Mama's Secret Recipe Book">üíñ</div>
  </div>

  <!-- THE APP -->
  <div id="app" class="app" role="dialog" aria-modal="true" aria-label="Mama's Secret Recipe Book">
    <div class="app-header">
      <div style="font-size:28px">üçã <span class="brand">Mama‚Äôs Secret Recipe Book</span> üçÉ</div>
      <div class="muted small">A warm, vintage cookbook ‚Äî save & share recipes with Mama's love.</div>
      <button id="closeApp" class="close-btn">Close</button>
    </div>

    <div class="vintage-border grid">
      <!-- LEFT: form + filters -->
      <aside class="side">
        <h3>New Recipe</h3>
        <label>Title</label>
        <input id="title" type="text" placeholder="e.g., Mama's Lemon Drizzle" />

        <label>Food Group</label>
        <select id="foodGroup">
          <option>Breakfast</option>
          <option>Lunch</option>
          <option>Dinner</option>
          <option>Snack</option>
          <option>Dessert</option>
          <option>Beverage</option>
        </select>

        <label>Ingredients (comma separated)</label>
        <textarea id="ingredients" placeholder="flour, sugar, eggs, lemon..."></textarea>
        <div class="row" style="margin-top:6px">
          <button id="startIngr" class="btn">üé§ Speak</button>
          <button id="stopIngr" class="btn alt">‚èπ Stop</button>
          <div class="small muted">(Tap Speak on mobile to dictate ingredients)</div>
        </div>

        <label style="margin-top:10px">Instructions</label>
        <textarea id="instructions" placeholder="Step 1: ..."></textarea>
        <div class="row" style="margin-top:6px">
          <button id="startInstr" class="btn">üé§ Speak</button>
          <button id="stopInstr" class="btn alt">‚èπ Stop</button>
          <div class="small muted">(Speak instructions ‚Äî speech will be transcribed)</div>
        </div>

        <label style="margin-top:10px">Add Image</label>
        <input id="imageFile" type="file" accept="image/*" />

        <label style="margin-top:10px">Add Video / OR Record</label>
        <input id="videoFile" type="file" accept="video/*" />
        <div style="margin-top:6px" class="row">
          <button id="startRecord" class="btn alt">üìπ Start Recording</button>
          <button id="stopRecord" class="btn alt">‚èπ Stop Recording</button>
          <div class="small muted">(Record directly from mobile/desktop)</div>
        </div>

        <label style="margin-top:10px">Allow public rating & guest name</label>
        <input id="guestNameInput" type="text" placeholder="Guest name (optional)" />

        <label style="margin-top:6px">Your Rating (1-3)</label>
        <select id="yourRating">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
        </select>

        <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
          <button id="saveBtn" class="btn">Save Recipe</button>
          <button id="saveHardBtn" class="btn alt">Hard Save (Local)</button>
          <button id="clearBtn" class="btn alt">Clear Form</button>
        </div>

        <hr style="margin:12px 0" />
        <h4>Filters & Search</h4>
        <label>Filter Food Group</label>
        <select id="filterGroup"><option>All</option><option>Breakfast</option><option>Lunch</option><option>Dinner</option><option>Snack</option><option>Dessert</option><option>Beverage</option></select>
        <label style="margin-top:8px">Search ingredients or title</label>
        <input id="search" type="text" placeholder="Search..." />
        <div style="margin-top:8px;display:flex;gap:8px"><button id="exportBtn" class="btn alt">Export JSON</button><button id="importBtn" class="btn alt">Import JSON</button></div>

      </aside>

      <!-- RIGHT: content -->
      <main class="main">
        <header style="display:flex;align-items:center;gap:12px">
          <h2>Saved Recipes</h2>
          <div style="margin-left:auto"> <span id="quote" class="muted"></span></div>
        </header>

        <section style="margin-top:12px;display:flex;gap:12px;flex-wrap:wrap;align-items:flex-start">
          <div style="flex:1;min-width:260px">
            <div id="list" class="recipe-list"></div>
          </div>

          <div style="width:360px;min-width:260px">
            <div class="selected" id="selectedArea">
              <h3>Recipe Details</h3>
              <div id="selectedContent">No recipe selected. Click a recipe to view details.</div>
            </div>

            <div style="margin-top:12px;background:#fff;padding:10px;border-radius:8px">
              <h4>Suggestions based on ingredients</h4>
              <div id="suggestions" class="small"></div>
            </div>

          </div>
        </section>

      </main>
    </div>

    <footer>Remember to thank Mama ‚Äî ‚ù§Ô∏èüçãüçÉ</footer>
  </div>

  <div class="celebrate" id="celebrateBox">üéâ Recipe saved! Celebrate with Mama üçãüçÉ</div>

  <!-- HOLY SFX (played when opening heart) -->
  <audio id="holySfx" preload="auto" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_f6cc2045d5.mp3?filename=angelic-choir-110253.mp3"></audio>

  <!-- Click SFX (tiny) -->
  <audio id="clickSfx" preload="auto" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAAAB3AQACABAAZGF0YQAAAAA="></audio>

  <script>
    /******************************************************************
     * Mama's Secret Recipe Book ‚Äî Fully expanded single-file app
     * - Speech-to-text (mobile-friendly)
     * - Image and Video upload & recording
     * - Ratings (1-3) with guest names
     * - Persistent storage + export/import
     * - Suggestions with external links
     * - Click sounds, holy sfx, celebration
     * - Organize by food group and nutritional complements
     * - Rich UI interactions
     ******************************************************************/

    // ---------- Utilities ----------
    const $ = id => document.getElementById(id);
    const clickSfx = $('clickSfx');
    function playClick(){ try{ clickSfx.currentTime = 0; clickSfx.play(); }catch(e){} }

    function uid(prefix='r'){ return prefix+'-'+Date.now()+'-'+Math.floor(Math.random()*99999); }

    function safeText(s){ return (s||'').toString().replace(/[&<>]/g, c=> ({'&':'&amp;','<':'&lt;','>':'&gt;'}[c])); }

    // ---------- App state & storage ----------
    const STORAGE_KEY = 'mamas_secret_recipes_v3';
    let recipes = [];
    let selectedId = null;

    function load(){ try{ const raw = localStorage.getItem(STORAGE_KEY); recipes = raw?JSON.parse(raw):[]; }catch(e){ recipes=[]; } }
    function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(recipes)); }

    // ---------- Init UI ----------
    const openHeart = $('openHeart'), appEl = $('app'), closeApp = $('closeApp');
    const holySfx = $('holySfx');
    openHeart.addEventListener('click', ()=>{ holySfx.currentTime=0; holySfx.play().catch(()=>{}); openHeart.style.display='none'; appEl.style.display='block'; showQuote(); playClick(); renderList(); });
    closeApp.addEventListener('click', ()=>{ appEl.style.display='none'; openHeart.style.display='block'; playClick(); });

    // ---------- Speech to text (improved) ----------
    let recognizers = {}; // keep separate recognizers per field

    function createRecognizer(fieldId){
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if(!SR) return null;
      const r = new SR();
      r.lang = 'en-US';
      r.interimResults = true; // show interim for smoother UX
      r.continuous = false; // single phrase per tap
      r.onresult = (ev)=>{
        let interim=''; let final='';
        for(let i=ev.resultIndex;i<ev.results.length;i++){
          const res = ev.results[i]; if(res.isFinal) final += res[0].transcript + ' '; else interim += res[0].transcript;
        }
        const fld = $(fieldId);
        if(!fld) return;
        // append final or update interim in a temporary placeholder
        if(final) fld.value += (fld.value? ' ':'') + final; else if(interim) fld.value = fld.value + interim; // simple
      };
      r.onerror = (e)=>{ console.warn('Speech error', e); };
      r.onend = ()=>{ delete recognizers[fieldId]; $(fieldId+'Start')?.removeAttribute('data-active'); $(fieldId+'Stop')?.setAttribute('disabled','true'); };
      return r;
    }

    // wire buttons
    ['Ingr','Instr'].forEach(suf=>{
      const fld = suf==='Ingr' ? 'ingredients':'instructions';
      $( 'start'+suf ).addEventListener('click', ()=>{
        if(recognizers[fld]) return; // already running
        const r = createRecognizer(fld); if(!r){ alert('Speech recognition not supported on this device. Try Chrome on Android or Safari on iOS.'); return; }
        recognizers[fld]=r; r.start(); $( 'stop'+suf ).removeAttribute('disabled'); playClick();
      });
      $( 'stop'+suf ).addEventListener('click', ()=>{ if(recognizers[fld]){ recognizers[fld].stop(); delete recognizers[fld]; } playClick(); });
    });

    // ---------- Video recording (MediaRecorder) ----------
    let mediaRecorder = null; let recordedBlobs = [];
    $('startRecord').addEventListener('click', async ()=>{
      playClick();
      if(!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia){ alert('Recording not supported.'); return; }
      try{
        const stream = await navigator.mediaDevices.getUserMedia({video:true,audio:true});
        recordedBlobs = [];
        mediaRecorder = new MediaRecorder(stream, {mimeType: 'video/webm;codecs=vp8,opus'});
        mediaRecorder.ondataavailable = e=>{ if(e.data && e.data.size>0) recordedBlobs.push(e.data); };
        mediaRecorder.onstop = ()=>{ // create blob and show preview
          const blob = new Blob(recordedBlobs, {type:'video/webm'});
          const url = URL.createObjectURL(blob);
          // attach to hidden input by setting data-url (we'll store blob later in memory)
          $('videoFile').dataset.recorded = url;
          // show a tiny preview
          const vid = document.createElement('video'); vid.controls=true; vid.src=url; vid.style.maxWidth='100%'; vid.style.marginTop='8px';
          if(!$('recordPreview')){ const p = document.createElement('div'); p.id='recordPreview'; $('videoFile').insertAdjacentElement('afterend', p); p.appendChild(vid); } else { $('recordPreview').innerHTML=''; $('recordPreview').appendChild(vid); }
        };
        mediaRecorder.start();
      }catch(err){ console.error(err); alert('Could not start recording: '+err.message); }
    });
    $('stopRecord').addEventListener('click', ()=>{ playClick(); if(mediaRecorder && mediaRecorder.state!=='inactive'){ mediaRecorder.stop(); mediaRecorder = null; } });

    // ---------- Save / add recipe ----------
    $('saveBtn').addEventListener('click', ()=>{ addRecipe(false); });
    $('saveHardBtn').addEventListener('click', ()=>{ addRecipe(true); });
    $('clearBtn').addEventListener('click', ()=>{ clearForm(); playClick(); });

    function clearForm(){ $('title').value=''; $('ingredients').value=''; $('instructions').value=''; $('imageFile').value=''; $('videoFile').value=''; $('guestNameInput').value=''; $('yourRating').value='1'; if($('videoFile').dataset.recorded){ delete $('videoFile').dataset.recorded; } }

    function addRecipe(hard=false){
      playClick();
      const title = $('title').value.trim();
      if(!title){ alert('Please give the recipe a title.'); return; }
      const foodGroup = $('foodGroup').value;
      const ing = $('ingredients').value.split(',').map(s=>s.trim()).filter(Boolean);
      const instr = $('instructions').value.trim();
      const guestName = $('guestNameInput').value.trim();
      const rating = parseInt($('yourRating').value||'1');

      // image handling (convert to dataURL if present)
      const imageFile = $('imageFile').files[0];
      const videoFileInput = $('videoFile').files[0];
      const recordedUrl = $('videoFile').dataset.recorded;

      const id = uid();
      const recipe = { id, title, foodGroup, ingredients:ing, instructions:instr, guestName, rating, created:Date.now(), tags:deriveComplements(ing), guests:[], imageData:null, videoData:null };

      const finalizeSave = ()=>{
        recipes.unshift(recipe);
        save();
        clearForm();
        renderList();
        showCelebration();
      };

      // handle image -> to data URL
      if(imageFile){ const reader = new FileReader(); reader.onload = ()=>{ recipe.imageData = reader.result; // continue to video handling
          handleVideoSave(recipe, videoFileInput, recordedUrl, finalizeSave);
        }; reader.readAsDataURL(imageFile);
      } else {
        handleVideoSave(recipe, videoFileInput, recordedUrl, finalizeSave);
      }

      if(hard) { /* already saved to localStorage; 'hard' currently same behavior, kept for future remote save option */ }
    }

    function handleVideoSave(recipe, videoFileInput, recordedUrl, cb){
      if(videoFileInput){ // create data url from file
        const r = new FileReader(); r.onload = ()=>{ recipe.videoData = r.result; cb(); }; r.readAsDataURL(videoFileInput);
      } else if(recordedUrl){ // we stored a blob URL from recording; fetch blob then convert
        fetch(recordedUrl).then(resp=>resp.blob()).then(blob=>{
          const fr = new FileReader(); fr.onload = ()=>{ recipe.videoData = fr.result; cb(); }; fr.readAsDataURL(blob);
        }).catch(err=>{ console.warn('Could not fetch recorded blob',err); cb(); });
      } else { cb(); }
    }

    // ---------- Derive complements / tags ----------
    function deriveComplements(ingredients){
      const i = (ingredients||[]).map(x=>x.toLowerCase());
      const tags = new Set();
      if(i.some(x=>x.includes('cheese'))) tags.add('Pairs with wine');
      if(i.some(x=>x.includes('lemon')||x.includes('citrus'))) tags.add('Bright & acidic');
      if(i.some(x=>x.includes('garlic')||x.includes('onion'))) tags.add('Savory');
      if(i.some(x=>x.includes('sugar')||x.includes('chocolate'))) tags.add('Sweet');
      if(i.some(x=>x.includes('chili')||x.includes('pepper'))) tags.add('Spicy');
      if(i.some(x=>x.includes('chicken')||x.includes('beef')||x.includes('pork'))) tags.add('Hearty & protein');
      if(tags.size===0) tags.add('Versatile');
      return Array.from(tags);
    }

    // ---------- Render list & details ----------
    function renderList(){
      load();
      const list = $('list'); list.innerHTML='';
      const filter = $('filterGroup').value; const q = ($('search').value||'').toLowerCase();
      const visible = recipes.filter(r=>{ if(filter!=='All' && r.foodGroup!==filter) return false; if(q){ if((r.title||'').toLowerCase().includes(q)) return true; if((r.ingredients||[]).join(' ').toLowerCase().includes(q)) return true; return false; } return true; });

      if(visible.length===0){ list.innerHTML='<div class="muted">No recipes yet ‚Äî add your first!</div>'; return; }

      visible.forEach(r=>{
        const card = document.createElement('div'); card.className='rcard';
        const thumb = document.createElement('div'); thumb.className='thumb'; if(r.imageData){ const img = document.createElement('img'); img.src=r.imageData; img.style.width='100%'; img.style.height='100%'; img.style.objectFit='cover'; img.style.borderRadius='8px'; thumb.appendChild(img);} else { thumb.innerHTML='üçã'; }
        const meta = document.createElement('div'); meta.className='meta';
        meta.innerHTML = `<strong>${safeText(r.title)}</strong><div class="small muted">${r.foodGroup} ‚Ä¢ ${r.ingredients.length} ingredients ‚Ä¢ ${r.tags.join(', ')}</div>`;
        const actions = document.createElement('div'); actions.style.display='flex'; actions.style.flexDirection='column'; actions.style.gap='6px';
        const viewBtn = document.createElement('button'); viewBtn.className='btn alt'; viewBtn.textContent='View'; viewBtn.onclick = ()=>{ selectRecipe(r.id); playClick(); };
        const quickRate = document.createElement('button'); quickRate.className='btn'; quickRate.textContent='Rate'; quickRate.onclick = ()=>{ promptRate(r.id); playClick(); };
        actions.appendChild(viewBtn); actions.appendChild(quickRate);
        card.appendChild(thumb); card.appendChild(meta); card.appendChild(actions);
        list.appendChild(card);
      });
    }

    function selectRecipe(id){
      selectedId = id; renderSelected();
    }

    function renderSelected(){
      const cont = $('selectedContent');
      if(!selectedId){ cont.innerHTML='<div class="muted">No recipe selected.</div>'; return; }
      const r = recipes.find(x=>x.id===selectedId); if(!r){ cont.innerHTML=''; return; }
      const avg = r.guests && r.guests.length ? (r.guests.reduce((s,g)=>s+g.rating,0)/r.guests.length).toFixed(1) : r.rating || '‚Äî';
      cont.innerHTML = `
        <h3>${safeText(r.title)} <span class="small muted">‚Ä¢ ${r.foodGroup}</span></h3>
        ${ r.imageData ? `<img src="${r.imageData}" alt="${safeText(r.title)}" style="max-width:100%;border-radius:8px;margin-top:8px">` : '' }
        <p style="margin-top:8px"><strong>Ingredients:</strong> ${safeText(r.ingredients.join(', '))}</p>
        <p><strong>Instructions:</strong><br/>${safeText(r.instructions).replace(/\n/g,'<br/>')}</p>
        <p><strong>Complements:</strong> ${r.tags.map(t=>'<span class="tag">'+safeText(t)+'</span>').join(' ')}</p>
        <p><strong>Average Rating:</strong> ${avg} / 3</p>
        ${ r.videoData ? `<video controls src="${r.videoData}" style="width:100%;margin-top:8px;border-radius:8px"></video>` : '' }
        <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
          <input id="guestName" type="text" placeholder="Your name" style="flex:1;padding:8px;border-radius:8px;border:1px solid #ddd" />
          <select id="guestRating"><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
          <button id="leaveRate" class="btn">Leave Rating</button>
        </div>
        <div id="guestList" style="margin-top:8px"></div>
        <div style="margin-top:10px;display:flex;gap:8px">
          <button id="exportRecipe" class="btn alt">Export</button>
          <button id="deleteRecipe" class="btn alt">Delete</button>
        </div>
      `;

      // wire leaveRate & delete & export
      $('leaveRate').addEventListener('click', ()=>{ const name = $('guestName').value.trim()||'Guest'; const rscore = parseInt($('guestRating').value); addGuestRating(selectedId, name, rscore); playClick(); });
      $('deleteRecipe').addEventListener('click', ()=>{ if(confirm('Delete this recipe?')){ recipes = recipes.filter(x=>x.id!==selectedId); save(); selectedId=null; renderList(); renderSelected(); playClick(); } });
      $('exportRecipe').addEventListener('click', ()=>{ const rec = recipes.find(x=>x.id===selectedId); if(!rec) return; const data = 'data:application/json;charset=utf-8,'+encodeURIComponent(JSON.stringify(rec)); const a=document.createElement('a'); a.href=data; a.download=(rec.title||'recipe')+'.json'; a.click(); playClick(); });

      renderGuestList(r);
      generateAndShowSuggestions(r.ingredients||[]);
    }

    function renderGuestList(recipe){
      const div = $('guestList'); div.innerHTML=''; const r = recipes.find(x=>x.id===selectedId); if(!r) return;
      if(r.guests && r.guests.length){ r.guests.forEach(g=>{ const p = document.createElement('div'); p.style.borderTop='1px solid #eee'; p.style.paddingTop='6px'; p.innerHTML=`<strong>${safeText(g.name)}</strong> ‚Äî Rating: ${g.rating}/3 <div class="small muted">${new Date(g.ts).toLocaleString()}</div>`; div.appendChild(p); }); } else { div.innerHTML='<div class="muted">No guest ratings yet ‚Äî be the first!</div>'; }
    }

    function addGuestRating(id,name,rating){ const rec = recipes.find(x=>x.id===id); if(!rec) return; rec.guests = rec.guests||[]; rec.guests.push({name, rating, ts:Date.now()}); save(); renderSelected(); }

    // ---------- Suggestions (with external links) ----------
    function generateAndShowSuggestions(ingredients){ const sug = generateSuggestions(ingredients); const el = $('suggestions'); el.innerHTML = sug.map(s=>`<div style="margin-bottom:8px">‚Ä¢ ${safeText(s.text)} <a href="${s.link}" target="_blank">(see)</a></div>`).join(''); }
    function generateSuggestions(ingredients){ const ing = (ingredients||[]).map(x=>x.toLowerCase()); const results=[]; function add(t,q){ results.push({text:t,link:makeSearchLink(q)}); }
      if(ing.some(i=>i.includes('lemon'))) add('Try a lemon curd tart or lemon drizzle cake','lemon dessert recipe');
      if(ing.some(i=>i.includes('chicken'))) add('Roast chicken with herbs and lemon','roasted chicken herbs recipe');
      if(ing.some(i=>i.includes('tomato'))) add('Fresh tomato salsa or rustic tomato sauce','tomato sauce recipe');
      if(ing.some(i=>i.includes('flour')||i.includes('sugar'))) add('Simple cookies or quick bread','easy baking recipe');
      if(ing.some(i=>i.includes('egg'))) add('Frittata or custard desserts','frittata recipe');
      if(results.length===0) add('Explore seasonal recipes online','easy recipes');
      return results;
    }
    function makeSearchLink(query){ const q = encodeURIComponent(query+' mama recipe'); return `https://www.google.com/search?q=${q}`; }

    // ---------- Suggestions show on main too ----------

    // ---------- Export / Import ----------
    $('exportBtn').addEventListener('click', ()=>{ const data = 'data:application/json;charset=utf-8,'+encodeURIComponent(JSON.stringify(recipes)); const a=document.createElement('a'); a.href=data; a.download='mama_recipes_backup.json'; a.click(); playClick(); });
    $('importBtn').addEventListener('click', ()=>{ const input = document.createElement('input'); input.type='file'; input.accept='application/json'; input.onchange = e=>{ const f = e.target.files[0]; if(!f) return; const r = new FileReader(); r.onload = ()=>{ try{ const imported = JSON.parse(r.result); if(Array.isArray(imported)){ recipes = imported.concat(recipes); save(); renderList(); alert('Import successful'); }else{ alert('Invalid file'); } }catch(err){ alert('Import failed: '+err.message); } }; r.readAsText(f); }; input.click(); playClick(); });

    // ---------- Delete all / reset (hidden) ----------
    function resetAll(){ if(confirm('Erase all saved recipes?')){ recipes=[]; save(); renderList(); alert('All cleared'); } }

    // ---------- Celebrations & Quotes ----------
    const quotes = ["A pinch of love makes everything better.","Cooking is love made visible.","Season well, taste often, laugh loudly.","A well-made meal is a hug from the inside.","Mama's secret is always an extra dash of care."];
    function showQuote(){ $('quote').innerText = quotes[Math.floor(Math.random()*quotes.length)]; }
    function showCelebration(){ const c = $('celebrateBox'); c.style.display='block'; c.innerText = 'üéâ Recipe saved! Celebrate with Mama üçãüçÉ'; setTimeout(()=>{ c.style.display='none'; },2400); }

    // ---------- Ratings prompt (quick) ----------
    function promptRate(id){ const name = prompt('Your name? (optional)') || 'Guest'; const val = prompt('Rate 1 (low) ‚Äî 3 (high)') || '3'; const n = parseInt(val); if(!n || n<1 || n>3) return alert('Invalid rating'); addGuestRating(id, name, n); }

    // ---------- Helpers on inputs ----------
    $('filterGroup').addEventListener('change', ()=>{ renderList(); });
    $('search').addEventListener('input', ()=>{ renderList(); });

    // ---------- Initial load ----------
    load(); renderList();

    // expose a console method for dev convenience
    window._mama = {recipes, save, load, renderList, resetAll};

  </script>
</body>
</html>
